<div>
  <div class="bg-white border border-slate-200 rounded-2xl shadow-sm p-8 mb-8">
    <div class="flex items-start justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold text-slate-900 mb-3"><%= @poll.title %></h1>
        <p class="text-slate-600"><%= @poll.description %></p>
      </div>

      <% if @poll.status == "draft" %>
        <span class="px-4 py-2 bg-slate-100 text-slate-700 font-medium rounded-full">
          下書き
        </span>
      <% elsif @poll.open? %>
        <span class="px-4 py-2 bg-green-100 text-green-700 font-medium rounded-full">
          受付中
        </span>
      <% else %>
        <span class="px-4 py-2 bg-rose-100 text-rose-700 font-medium rounded-full">
          終了
        </span>
      <% end %>
    </div>

    <div class="flex items-center gap-6 text-sm text-slate-500 mb-6 border-t pt-6">
      <span>選択肢: <%= @poll.choices.count %>個</span>
      <span>総投票数: <%= @poll.votes.count %></span>
      <% if @poll.ends_at.present? %>
        <span>締切: <%= @poll.ends_at.strftime("%Y年%m月%d日 %H:%M") %></span>
      <% end %>
    </div>

    <% if @poll.open? %>
      <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-6 mb-6">
        <h2 class="text-lg font-semibold text-indigo-900 mb-4">投票する</h2>
        <%= form_with url: poll_votes_path(@poll), local: true do |f| %>
          <div class="space-y-3 mb-6">
            <% @choices.each do |choice| %>
              <label class="flex items-center p-3 bg-white border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition">
                <%= radio_button_tag :choice_id, choice.id, false, 
                    class: "text-indigo-600 focus:ring-indigo-500" %>
                <span class="ml-3 text-slate-900"><%= choice.label %></span>
              </label>
            <% end %>
          </div>
          <%= f.submit "投票する", 
              class: "w-full px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition cursor-pointer" %>
        <% end %>
      </div>
    <% end %>

    <div class="mb-6">
      <h2 class="text-lg font-semibold text-slate-900 mb-4">
        <%= @poll.closed? || !@poll.open? ? "最終結果" : "現在の結果" %>
      </h2>
      <div class="space-y-3">
        <% @choices.each do |choice| %>
          <div>
            <div class="flex items-center justify-between text-sm mb-2">
              <span class="text-slate-900 font-medium"><%= choice.label %></span>
              <span class="text-slate-600">
                <%= choice.votes_count %>票 
                (<%= @poll.votes.any? ? (choice.votes_count.to_f / @poll.votes.count * 100).round(1) : 0 %>%)
              </span>
            </div>
            <div class="w-full bg-slate-100 rounded-full h-2">
              <div class="bg-indigo-600 h-2 rounded-full transition-all duration-500"
                   style="width: <%= @poll.votes.any? ? (choice.votes_count.to_f / @poll.votes.count * 100) : 0 %>%"></div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <div class="flex items-center gap-3 pt-6 border-t">
      <% if @poll.status == "draft" %>
        <%= button_to "公開する", open_poll_path(@poll), method: :post,
            class: "px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition" %>
      <% elsif @poll.status == "open" %>
        <%= button_to "終了する", close_poll_path(@poll), method: :post,
            class: "px-6 py-2 bg-rose-600 text-white font-medium rounded-lg hover:bg-rose-700 transition",
            data: { confirm: "本当に終了しますか？" } %>
      <% end %>
      <%= link_to "編集", edit_poll_path(@poll),
          class: "px-6 py-2 bg-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-300 transition" %>
      <%= link_to "一覧に戻る", polls_path,
          class: "px-6 py-2 text-slate-600 hover:text-slate-900 transition" %>
    </div>
  </div>
</div>